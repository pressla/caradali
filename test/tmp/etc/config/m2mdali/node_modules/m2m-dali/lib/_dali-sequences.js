//dali-sequences.js
//Author Alex Pressl for imitrix GmbH
var async = require('async');
var colors = require('colors');
var Serial = require ('serialport').SerialPort;
var serialPort;


var commands = [
	['sendcmd',0xFF, 0x00],	//set lamp OFF
	['sendcmd',0xFF, 0x05], //set lamp ON
	['sendcmd',0xFF, 0x06], //set lamp to minimum value
	['sendcmd',0xFF, 0x08], //inc arc level
	['sendcmd',0xFF, 0x07], //dec arc level
	['sendcmd',0xFF, 0x01], //inc dim fade 200ms
	['sendcmd',0xFF, 0x02], //dec dim fase 200ms

	['sendcmd',0xFF, 0x21], //store current light level in DTR
	['sendcmd',0xFF, 0x40], //set scene ID 			with DTR
	['sendcmd',0xFF, 0x2D], //set power on level 	with DTR
	['sendcmd',0xFF, 0x2A], //set maximul level		with DTR
	['sendcmd',0xFF, 0x2B], //set minimum level		with DTR
	['sendcmd',0xFF, 0x2C], //set failure level		with DTR
	['sendcmd',0xFF, 0x2E], //set fade time			with DTR
	['sendcmd',0xFF, 0x2F], //set fade rate			with DTR

	['sendcmd',0xFF, 0x10], //set scene ID active


	['sendcmd',0xFF, 0xA0], //read current light level

	['sendcmd',0xA1, 0x00], //stop all ongoing activity
	['sendcmd',0xA3, 0x00], //write value to DTR

];

module.exports = seqInitialize = [
	['sendcmd',0xFF, 0x00, 'set lamp OFF'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x21, 'store current light level in DTR'],
	['sendcmd',0xFF, 0x2B, 'set minimum level		with DTR'],
	['sendcmd',0xFF, 0x2D, 'set power on level 	with DTR'],

	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x21, 'store current light level in DTR'],
	['sendcmd',0xFF, 0x2A, 'set maximum level		with DTR'],

	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x21, 'store current light level in DTR'],
	['sendcmd',0xFF, 0x2C, 'set failure level		with DTR'],

	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
];

module.exports = seqForceMin = [
	['sendcmd',0xFF, 0x00, 'set lamp OFF'],
	['sendcmd',0xFF, 0x21, 'store current light level in DTR'],
	['sendcmd',0xFF, 0x2B, 'set minimum level		with DTR'],
	['sendcmd',0xFF, 0x2B, 'set minimum level		with DTR'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x21, 'store current light level in DTR'],
	['sendcmd',0xFF, 0x2D, 'set power on level 	with DTR'],
	['sendcmd',0xFF, 0x2D, 'set power on level 	with DTR'],


	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
];

module.exports = seqCheck = [
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x9A, 'ret physical level minimum value'],
	['sendcmd',0xFF, 0xA2, 'ret minimum level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0x21, 'store current light level in DTR'],
	['sendcmd',0xFF, 0x2D, 'set power on level 	with DTR'],
	['sendcmd',0xFF, 0x00, 'set lamp OFF'],
	['sendcmd',0xFF, 0x00, 'set lamp OFF'],
	['sendcmd',0xFF, 0x00, 'set lamp OFF'],
	['sendcmd',0xFF, 0x00, 'set lamp OFF'],
	['sendcmd',0xFF, 0x00, 'set lamp OFF'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0xA0, 'ret current level  value'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x07, 'dec arc level'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x04, 'dec2 arc level'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],

	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x03, 'inc2 arc level'],
	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
];


module.exports = seqTest = [
	['sendcmd',0xFF, 0x00, 'set lamp OFF'],
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],

	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],

	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],

	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],


	['sendcmd',0xFF, 0x06, 'set arc level to minimum value']
];
module.exports = seqOn = [
	['sendcmd',0xFF, 0x08, 'inc arc level'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],
	['sendcmd',0xFF, 0x01, 'inc dim fade 200ms'],

	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],
];

module.exports = seqOff = [

	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],

	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
	['sendcmd',0xFF, 0x00, 'set lamp OFF'],
];

module.exports = seqMin = [

	['sendcmd',0xFF, 0x05, 'set arc level to maximum (full ON)'],

	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x02, 'dec dim fase 200ms'],
	['sendcmd',0xFF, 0x06, 'set arc level to minimum value'],
];
var myPlugin;

module.exports = initSeq = function (plugin) {
	myPlugin = plugin;
    serialPort = new Serial ('/dev/ttyUSB0', {baudrate:115200}, false);
	serialPort.on('data', function(data) {
		plugin.log('info','Serial DALI data received: ' + data);
	});
}

module.exports = executeSeq = function (seq) {
	myPlugin.log('info','Begin executeSeq'.bold.grey);
    serialPort.open(function (err) {
        if (err) {
            myPlugin.log('info', 'Error open DALI serialport : '.bold.red+ err);
            
        } else {
			async.eachSeries (seq, sendcmd, executeSeqComplete);
		}
	});
}

function executeSeqComplete(err) {
	serialPort.close();
	if (err)
		myPlugin.log('info','executeSeq Failed'.bold.red);
	else
		myPlugin.log('info','executeSeq Success'.bold.grey);
}

function sendcmd(opcode, callback) {
	var adr = (("0" + opcode[1].toString(16)).substr(-2)).toUpperCase();
	var pay = (("0" + opcode[2].toString(16)).substr(-2)).toUpperCase();
    myPlugin.log('info','Send: '+ opcode[0].yellow+' '+adr.green+' '+pay.green+' >>'+opcode[3].red);
    sendSeq(opcode);

	var result = 'ok';
    setTimeout(function(){
      callback(null, result);
    }, 200);	
}

function sendSeq(msg) {
	{
		{
            myPlugin.log('info','Serial port is connected and opened'.grey);
            var a = parseInt(msg[1]);
            var adr = (("0" + a.toString(16)).substr(-2)).toUpperCase();
            c = parseInt(msg[2]);
            var cmd = (("0" + c.toString(16)).substr(-2)).toUpperCase();
            var frame = "#DALI:"+adr+cmd+"\r\n";
            serialPort.write(frame, function(err, results) {
                if (err) {
                    myPlugin.log('info', 'Error Write 1'.bold.red+frame+' to DALI serialport : '+ err);
                }
                myPlugin.log('info','DALI serial write 1:'.grey+frame+' result: ' + results);
                if ((a>=0xF0) && c>=32 && c<=128) {
                    //setTimeout(repeatCommand(frame),800);
                }
                
            });
        } 
    }
}

function repeatCommand (frame) {
    serialPort.write(frame, function(err, results) {
        if (err) {
            myPlugin.log('info', 'Error Write 2'.bold.red+frame+' to DALI serialport : '+ err);
        }
        myPlugin.log('info','DALI serial write 2:'.grey+frame+' result: ' + results);
    });

}
